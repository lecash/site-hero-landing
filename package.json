{
  "name": "site-hero-landing",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "gate:syntax": "node -c api/ios-shortcut.js",
    "gate:contamination": "node -e \"const fs=require('fs'); const c=fs.readFileSync('api/ios-shortcut.js','utf8'); const bad=['describe(','it(','expect(','vi.','vitest','beforeAll','afterEach','mockReqRes','makeReqRes']; for(const b of bad){ if(c.includes(b)){ console.error('GATE-Contamination FAIL:',b); process.exit(1);} }\"",
    "gate:exports": "node -e \"const fs=require('fs'); const c=fs.readFileSync('api/ios-shortcut.js','utf8'); const m=(c.match(/export\\s+default/g)||[]).length; if(m!==1){ console.error('GATE-Exports FAIL: export default count =',m); process.exit(1);} \"",
    "gate:auth": "node -e \"const fs=require('fs'); const c=fs.readFileSync('api/ios-shortcut.js','utf8'); if(!c.includes('timingSafeEqual')){ console.error('GATE-Auth FAIL: timingSafeEqual ausente'); process.exit(1);} if(/Authorization[^\\n]*===/.test(c) || /token[^\\n]*===/.test(c)){ console.error('GATE-Auth FAIL: comparação === detectada'); process.exit(1);} \"",
    "gate:timeout": "node -e \"const fs=require('fs'); const c=fs.readFileSync('api/ios-shortcut.js','utf8'); if(!c.includes('AbortController') || !c.includes('3000')){ console.error('GATE-Timeout FAIL: AbortController/3000ms ausente'); process.exit(1);} \"",
    "gate:repohygiene": "node -e \"const fs=require('fs');const cp=require('child_process');const gi=fs.readFileSync('.gitignore','utf8');const req=['.env','.env.*','*.bak','*.bak.*'];for(const r of req){if(!gi.includes(r)){console.error('GATE-RepoHygiene FAIL: .gitignore missing',r);process.exit(1);}}const files=cp.execSync('git ls-files',{encoding:'utf8'}).split(/\\r?\\n/).filter(Boolean);const bad=files.filter(f=>/\\.env$|\\.env\\.|\\.bak$|\\.bak\\.|\\.log$/i.test(f));if(bad.length){console.error('GATE-RepoHygiene FAIL: sensitive tracked files',bad.join(', '));process.exit(1);}\"",
    "gate:upstream": "node -e \"const fs=require('fs');const c=fs.readFileSync('api/ios-shortcut.js','utf8');const checks=[c.includes('getUpstreamAllowlist'),c.includes('upstreamAllowlist.has(upstream)'),c.includes('new URL('),c.includes('/ping'),c.includes('/run')];if(checks.some(v=>!v)){console.error('GATE-Upstream FAIL: upstream hardening markers missing');process.exit(1);}\"",
    "gate:noexternaldeps": "node -e \"const fs=require('fs');const p=JSON.parse(fs.readFileSync('package.json','utf8'));const allowDeps=['@ngrok/ngrok','cors','express','localtunnel'];const allowDev=['supertest','vite','vitest'];const deps=Object.keys(p.dependencies||{});const dev=Object.keys(p.devDependencies||{});const badDeps=deps.filter(d=>!allowDeps.includes(d));const badDev=dev.filter(d=>!allowDev.includes(d));if(badDeps.length||badDev.length){console.error('GATE-NoExternalDeps FAIL:',[...badDeps,...badDev].join(', '));process.exit(1);}\"",
    "gate:safelog": "node -e \"const fs=require('fs'); const c=fs.readFileSync('api/ios-shortcut.js','utf8'); const stripped=c.replace(/function\\s+safeLog[\\s\\S]*?\\n}\\s*/m,''); if(stripped.includes('console.log')) { console.error('GATE-SafeLog FAIL: console.log vazado fora do safeLog'); process.exit(1); }\"",
    "gates": "npm run gate:syntax && npm run gate:contamination && npm run gate:exports && npm run gate:auth && npm run gate:timeout && npm run gate:repohygiene && npm run gate:upstream && npm run gate:noexternaldeps && npm run gate:safelog",
    "test": "npm run gates && vitest run"
  },
  "devDependencies": {
    "supertest": "^7.2.2",
    "vite": "^7.2.4",
    "vitest": "^4.0.18"
  },
  "dependencies": {
    "@ngrok/ngrok": "^1.7.0",
    "cors": "^2.8.6",
    "express": "^5.2.1",
    "localtunnel": "^1.8.3"
  }
}
